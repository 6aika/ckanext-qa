<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip="">

  <py:def function="page_title">Quality Assurance</py:def>

<py:def function="body_class">no-sidebar</py:def>

  <py:def function="optional_head">
    <script type="text/javascript" src="http://assets.okfn.org/ext/flot/0.6/jquery.flot.min.js">//pointless jscript comment</script>
    <link type="text/css" rel="stylesheet" media="all" href="/css/ckanext-qa.css" />
  </py:def>

  <div py:match="content">
    <div class="qa-content">
      <h1>Quality Assurance</h1>
      <py:if test="not c.organisation">
        <p>No results found for this organization.</p>
      </py:if>

      <py:if test="c.organisation">
        <h1>${c.organisation.title}</h1>
        <ul>
            <li>${h.link_to('Download report in CSV format', h.url_for('qa_api_resource_formatted', action='broken_resource_links_by_dataset_for_organisation', id=c.id, format='csv'))}</li>
        </ul>

        <h2>Packages with Broken Resource Links</h2>
        <py:for each="package, resources in c.organisation.packages.items()">
          <h3>${h.link_to(package[1], h.url_for(controller='package', action='read', id=package[0]))}</h3>
          <div style="padding-left: 20px">
          <table class="table table-striped table-bordered table-condensed"  style="width: 100%; table-layout: fixed;">
            <tr>
              <th class="qa-table-name">Resource</th>
              <th class="qa-table-name" style="width: 200px">Reason</th>
            </tr>
            <tr py:for="resource in resources">
              <td><a href="${resource.url}" style="word-wrap:break-word;">${resource.url}</a></td><td>${resource.get('openness_score_reason', '')}</td>
            </tr>
          </table>
          </div>
        </py:for>
      </py:if>
    </div>
  </div>
  <xi:include href="../../../../layout.html" />
</html>

