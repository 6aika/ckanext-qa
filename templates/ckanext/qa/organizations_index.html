<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip="">

  <py:def function="page_title">Quality Assurance</py:def>

  <py:def function="optional_head">
    <!--[if IE]><script language="javascript" type="text/javascript" src="http://assets.okfn.org/ext/flot/0.6/excanvas.min.js"></script><![endif]-->
    <script type="text/javascript" src="http://assets.okfn.org/ext/flot/0.6/jquery.flot.min.js">//pointless jscript comment</script>
    <link type="text/css" rel="stylesheet" media="all" href="/ckanext/qa/style.css" />
  </py:def>

  <div py:match="content" class="qa-content">
    <div class="qa-content">
    <h1>Quality Assurance</h1>
  
    <h3>Organizations who have published packages with broken resource links.</h3>
        
    <table class="qa-table">
      <tr>
          <th class="qa-table-name">Organization name</th>
          <th class="qa-table-published-by">Published By</th>
          <th class="qa-table-published-via">Published Via</th>
          <th class="qa-table-checked">Last checked</th>
      </tr>
      <tr py:for="package in c.packages">
        <td>${h.link_to(package.get('organization_name'), h.url_for(controller='qa', action='organizations_with_broken_resource_links', id=package.get('organization_id')))}</td>
        <?python
            from datetime import datetime
            timestr = package.get('openness_score_last_checked')
            if timestr:
                timestamp = datetime.strptime(timestr,'%Y-%m-%dT%H:%M:%S.%f')
            else:
                timestamp = None
        ?>
        <td>${package.get('published_by')}</td>
        <td>${package.get('published_via')}</td>
        <td>${timestamp.strftime('%c') if timestamp else 'Never'}</td>
      </tr>
    </table>
  </div>
  
  <p>
    Page last updated:
     <?python 
        import datetime
     ?>
    ${datetime.datetime.now().strftime('%c')}
  </p>
  </div>
  <xi:include href="../../layout.html" />
</html>
